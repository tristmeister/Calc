<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Investment Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --bright-green: #4CAF50;
            --dark-gray: #333;
            --light-gray: #f0f0f0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }
        h1 {
            color: var(--bright-green);
            text-align: center;
        }
        .input-group {
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="date"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="range"] {
            width: 100%;
            margin-top: 10px;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .button-group button {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--bright-green);
            background-color: white;
            color: var(--bright-green);
            cursor: pointer;
            transition: all 0.3s;
        }
        .button-group button.active {
            background-color: var(--bright-green);
            color: white;
        }
        .button-group button:first-child {
            border-radius: 4px 0 0 4px;
        }
        .button-group button:last-child {
            border-radius: 0 4px 4px 0;
        }
        button {
            background-color: var(--bright-green);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            margin-top: 20px;
            font-weight: bold;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result-value {
            font-size: 1.2em;
            color: var(--bright-green);
        }
        canvas {
            margin-top: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .icon {
            margin-right: 5px;
        }
        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-buttons button {
            background-color: white;
            color: var(--dark-gray);
            border: 1px solid var(--dark-gray);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab-buttons button.active {
            background-color: var(--bright-green);
            color: white;
            border-color: var(--bright-green);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .input-group {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-chart-line icon"></i> Advanced Investment Calculator</h1>
    
    <div class="tab-buttons">
        <button class="active" data-tab="single">Single Index</button>
        <button data-tab="comparison">Index Comparison</button>
    </div>

    <div id="singleTab" class="tab-content active">
        <div class="input-group">
            <div class="button-group">
                <button class="mode-button active" data-mode="past"><i class="fas fa-history icon"></i> Past</button>
                <button class="mode-button" data-mode="future"><i class="fas fa-forward icon"></i> Future</button>
            </div>
        </div>
        
        <div class="input-group">
            <label><i class="fas fa-calendar-alt icon"></i> Start Date: <input type="date" id="startDate"></label>
            <label><i class="fas fa-calendar-check icon"></i> End Date: <input type="date" id="endDate"></label>
        </div>
        
        <div class="input-group">
            <label><i class="fas fa-dollar-sign icon"></i> Monthly Investment ($): 
                <input type="range" id="investmentSlider" min="1" max="2000" step="1" value="500">
                <input type="number" id="investmentInput" min="1" max="2000" value="500">
            </label>
        </div>
        
        <div class="input-group">
            <div class="button-group">
                <button class="interest-button active" data-interest="compound"><i class="fas fa-chart-line icon"></i> Compound</button>
                <button class="interest-button" data-interest="simple"><i class="fas fa-chart-bar icon"></i> Simple</button>
            </div>
        </div>
        
        <div class="input-group">
            <label><i class="fas fa-globe icon"></i> Select Index:
                <select id="indexSelect">
                    <option value="SP500">S&P 500 (US) - Moderate Risk</option>
                    <option value="STOXX600">STOXX 600 (Europe) - Moderate Risk</option>
                    <option value="NIKKEI225">Nikkei 225 (Japan) - Moderate Risk</option>
                    <option value="MSCIWORLD">MSCI World - Moderate Risk</option>
                    <option value="NASDAQ">NASDAQ - High Risk</option>
                    <option value="RUSSELL2000">Russell 2000 - High Risk</option>
                    <option value="CUSTOM">Custom Return Rate</option>
                </select>
            </label>
            <div id="customRateInput" style="display: none;">
                <label>Custom Annual Return Rate (%): <input type="number" id="customRate" min="0" max="100" step="0.1" value="7"></label>
            </div>
        </div>

        <div class="input-group">
            <label><i class="fas fa-percentage icon"></i> Inflation Rate (%):
                <input type="number" id="inflationRate" min="0" max="20" step="0.1" value="2">
            </label>
        </div>

        <div class="input-group">
            <label><i class="fas fa-file-invoice-dollar icon"></i> Tax Option:
                <select id="taxOption">
                    <option value="none">No Tax</option>
                    <option value="us">US Tax</option>
                    <option value="germany">Germany Tax</option>
                </select>
            </label>
        </div>

        <div class="input-group">
            <label><i class="fas fa-bullseye icon"></i> Goal Amount ($):
                <input type="number" id="goalAmount" min="0" step="1000" value="0">
            </label>
        </div>
        
        <button onclick="calculate()"><i class="fas fa-calculator icon"></i> Calculate</button>
        
        <div id="results"></div>
        
        <canvas id="chart"></canvas>
    </div>

    <div id="comparisonTab" class="tab-content">
        <!-- Comparison mode content here -->
        <p>Comparison mode is under development. Check back soon!</p>
    </div>

    <script>
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const investmentSlider = document.getElementById('investmentSlider');
        const investmentInput = document.getElementById('investmentInput');
        const indexSelect = document.getElementById('indexSelect');
        const customRateInput = document.getElementById('customRateInput');
        const customRate = document.getElementById('customRate');
        const inflationRate = document.getElementById('inflationRate');
        const taxOption = document.getElementById('taxOption');
        const goalAmount = document.getElementById('goalAmount');
        const resultsDiv = document.getElementById('results');
        const ctx = document.getElementById('chart').getContext('2d');
        let chart;

        // Set default dates
        const today = new Date();
        startDateInput.value = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
        endDateInput.value = new Date(today.getFullYear() + 1, today.getMonth(), 0).toISOString().split('T')[0];

        // Sync slider and input
        investmentSlider.addEventListener('input', () => investmentInput.value = investmentSlider.value);
        investmentInput.addEventListener('input', () => investmentSlider.value = investmentInput.value);

        // Mode button functionality
        const modeButtons = document.querySelectorAll('.mode-button');
        modeButtons.forEach(button => {
            button.addEventListener('click', () => {
                modeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                calculate();
            });
        });

        // Interest type button functionality
        const interestButtons = document.querySelectorAll('.interest-button');
        interestButtons.forEach(button => {
            button.addEventListener('click', () => {
                interestButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                calculate();
            });
        });

        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-buttons button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(`${tabName}Tab`).classList.add('active');
            });
        });

        // Show/hide custom rate input
        indexSelect.addEventListener('change', () => {
            customRateInput.style.display = indexSelect.value === 'CUSTOM' ? 'block' : 'none';
            calculate();
        });

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        }

        function calculate() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const monthlyInvestment = parseFloat(investmentInput.value);
            const mode = document.querySelector('.mode-button.active').dataset.mode;
            const interestType = document.querySelector('.interest-button.active').dataset.interest;
            const selectedIndex = indexSelect.value;
            const inflationRateValue = parseFloat(inflationRate.value) / 100;
            const taxOptionValue = taxOption.value;
            const goalAmountValue = parseFloat(goalAmount.value);

            let total = 0;
            let invested = 0;
            const dataPoints = [];
            const labels = [];

            // Estimated annual returns for different indexes (adjust as needed)
            const annualReturns = {
                SP500: { past: 0.10, future: 0.08 },
                STOXX600: { past: 0.08, future: 0.07 },
                NIKKEI225: { past: 0.09, future: 0.07 },
                MSCIWORLD: { past: 0.09, future: 0.075 },
                NASDAQ: { past: 0.12, future: 0.10 },
                RUSSELL2000: { past: 0.11, future: 0.09 },
                CUSTOM: { past: parseFloat(customRate.value) / 100, future: parseFloat(customRate.value) / 100 }
            };

            const annualReturn = annualReturns[selectedIndex][mode];
            const monthlyReturn = Math.pow(1 + annualReturn, 1/12) - 1;

            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                invested += monthlyInvestment;
                
                if (interestType === 'compound') {
                    total = (total + monthlyInvestment) * (1 + monthlyReturn);
                } else {
                    total += monthlyInvestment + (invested * monthlyReturn);
                }

                // Apply inflation adjustment
                total /= (1 + inflationRateValue / 12);

                dataPoints.push(total);
                labels.push(currentDate.toISOString().split('T')[0]);
                currentDate.setMonth(currentDate.getMonth() + 1);
            }

            // Apply tax
            let taxRate = 0;
            if (taxOptionValue === 'us') taxRate = 0.15; // Simplified US long-term capital gains tax
            if (taxOptionValue === 'germany') taxRate = 0.25; // Simplified German capital gains tax

            const gainBeforeTax = total - invested;
            const taxAmount = gainBeforeTax * taxRate;
            const totalAfterTax = total - taxAmount;

            resultsDiv.innerHTML = `
                <p>Total (Before Tax): <span class="result-value">${formatCurrency(total)}</span></p>
                <p>Total (After Tax): <span class="result-value">${formatCurrency(totalAfterTax)}</span></p>
                <p>Invested: <span class="result-value">${formatCurrency(invested)}</span></p>
                <p>Gained (After Tax): <span class="result-value">${formatCurrency(totalAfterTax - invested)}</span></p>
                <p>Tax Paid: <span class="result-value">${formatCurrency(taxAmount)}</span></p>
            `;

            if (goalAmountValue > 0) {
                const monthsToGoal = Math.ceil(Math.log(goalAmountValue / total) / Math.log(1 + monthlyReturn));
                resultsDiv.innerHTML += `<p>Months to reach goal: <span class="result-value">${monthsToGoal}</span></p>`;
            }
          if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Portfolio Value',
                        data: dataPoints,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initial calculation
        calculate();

        // Add event listeners for real-time updates
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', calculate);
        });

        // Comparison mode functionality (placeholder)
        function compareIndexes() {
            // This function will be implemented when the comparison mode is developed
            console.log("Compare indexes functionality to be implemented");
        }
    </script>
</body>
</html>
